/*
 2013 Pixel & Tonic, Inc.. All rights reserved.
 @author    Brandon Kelly <brandon@pixelandtonic.com>
 @version   0.1
 @license   THIS IS NO F.O.S.S!
*/
(function(c){var h=function(){};h.extend=function(a,b){var d=h.prototype.extend;h._prototyping=!0;var c=new this;d.call(c,a);c.base=function(){};delete h._prototyping;var f=c.constructor,g=c.constructor=function(){if(!h._prototyping)if(this._constructing||this.constructor==g)this._constructing=!0,f.apply(this,arguments),delete this._constructing;else if(null!=arguments[0])return(arguments[0].extend||d).call(arguments[0],c)};g.ancestor=this;g.extend=this.extend;g.forEach=this.forEach;g.implement=this.implement;
g.prototype=c;g.toString=this.toString;g.valueOf=function(a){return"object"==a?g:f.valueOf()};d.call(g,b);"function"==typeof g.init&&g.init();return g};h.prototype={extend:function(a,b){if(1<arguments.length){var c=this[a];if(c&&"function"==typeof b&&(!c.valueOf||c.valueOf()!=b.valueOf())&&/\bbase\b/.test(b)){var e=b.valueOf();b=function(){var a=this.base||h.prototype.base;this.base=c;var b=e.apply(this,arguments);this.base=a;return b};b.valueOf=function(a){return"object"==a?b:e};b.toString=h.toString}this[a]=
b}else if(a){var f=h.prototype.extend;h._prototyping||"function"==typeof this||(f=this.extend||f);for(var g={toSource:null},k=["constructor","toString","valueOf"],p=h._prototyping?0:1;l=k[p++];)a[l]!=g[l]&&f.call(this,l,a[l]);for(var l in a)g[l]||f.call(this,l,a[l])}return this}};h=h.extend({constructor:function(a){this.extend(a)}},{ancestor:Object,version:"1.1",forEach:function(a,b,c){for(var e in a)void 0===this.prototype[e]&&b.call(c,a[e],e,a)},implement:function(){for(var a=0;a<arguments.length;a++)if("function"==
typeof arguments[a])arguments[a](this.prototype);else this.prototype.extend(arguments[a]);return this},toString:function(){return String(this.valueOf())}});if("undefined"!=typeof Garnish)throw"Garnish is already defined!";Garnish={$win:c(window),$doc:c(document),$bod:c(document.body)};Garnish.rtl=Garnish.$bod.hasClass("rtl");Garnish.ltr=!Garnish.rtl;Garnish=c.extend(Garnish,{DELETE_KEY:8,SHIFT_KEY:16,CTRL_KEY:17,ALT_KEY:18,RETURN_KEY:13,ESC_KEY:27,SPACE_KEY:32,LEFT_KEY:37,UP_KEY:38,RIGHT_KEY:39,DOWN_KEY:40,
A_KEY:65,S_KEY:83,CMD_KEY:91,PRIMARY_CLICK:1,SECONDARY_CLICK:3,X_AXIS:"x",Y_AXIS:"y",TEXT_NODE:3,log:function(a){"undefined"!=typeof console&&"function"==typeof console.log&&console.log(a)},_isMobileBrowser:null,_isMobileOrTabletBrowser:null,isMobileBrowser:function(a){var b=a?"_isMobileOrTabletBrowser":"_isMobileBrowser";if(null===Garnish[b]){var c=navigator.userAgent||navigator.vendor||window.opera;Garnish[b]=RegExp("(android|bbd+|meego).+mobile|avantgo|bada/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)/|plucker|pocket|psp|series(4|6)0|symbian|treo|up.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino"+
(a?"|android|ipad|playbook|silk":""),"i").test(c)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(c.substr(0,
4))}return Garnish[b]},isArray:function(a){return a instanceof Array},isJquery:function(a){return a instanceof jQuery},isString:function(a){return"string"==typeof a},isTextNode:function(a){return a.nodeType==Garnish.TEXT_NODE},getDist:function(a,b,c,e){return Math.sqrt(Math.pow(a-c,2)+Math.pow(b-e,2))},hitTest:function(a,b,d){Garnish.hitTest._$elem=c(d);Garnish.hitTest._offset=Garnish.hitTest._$elem.offset();Garnish.hitTest._x1=Garnish.hitTest._offset.left;Garnish.hitTest._y1=Garnish.hitTest._offset.top;
Garnish.hitTest._x2=Garnish.hitTest._x1+Garnish.hitTest._$elem.outerWidth();Garnish.hitTest._y2=Garnish.hitTest._y1+Garnish.hitTest._$elem.outerHeight();return a>=Garnish.hitTest._x1&&a<Garnish.hitTest._x2&&b>=Garnish.hitTest._y1&&b<Garnish.hitTest._y2},isCursorOver:function(a,b){return Garnish.hitTest(a.pageX,a.pageY,b)},copyTextStyles:function(a,b){var d=c(a);c(b).css({fontFamily:d.css("fontFamily"),fontSize:d.css("fontSize"),fontWeight:d.css("fontWeight"),letterSpacing:d.css("letterSpacing"),lineHeight:d.css("lineHeight"),
textAlign:d.css("textAlign"),textIndent:d.css("textIndent"),whiteSpace:d.css("whiteSpace"),wordSpacing:d.css("wordSpacing"),wordWrap:d.css("wordWrap")})},getBodyScrollTop:function(){Garnish.getBodyScrollTop._scrollTop=document.body.scrollTop;0>Garnish.getBodyScrollTop._scrollTop?Garnish.getBodyScrollTop._scrollTop=0:(Garnish.getBodyScrollTop._maxScrollTop=Garnish.$bod.outerHeight()-Garnish.$win.height(),Garnish.getBodyScrollTop._scrollTop>Garnish.getBodyScrollTop._maxScrollTop&&(Garnish.getBodyScrollTop._scrollTop=
Garnish.getBodyScrollTop._maxScrollTop));return Garnish.getBodyScrollTop._scrollTop},scrollContainerToElement:function(a,b){var d=c(a),e=c(b),f=d.scrollTop(),g=e.offset().top,g=d[0]==window?g-f:g-d.offset().top;if(0>g)d.scrollTop(f+g);else{var e=e.outerHeight(),k=d[0]==window?window.innerHeight:d[0].clientHeight;g+e>k&&d.scrollTop(f+(g-(k-e)))}},SHAKE_STEPS:10,SHAKE_STEP_DURATION:25,shake:function(a,b){var d=c(a);b||(b="margin-left");var e=parseInt(d.css(b));isNaN(e)&&(e=0);for(var f=0;f<=Garnish.SHAKE_STEPS;f++)(function(a){setTimeout(function(){Garnish.shake._properties=
{};Garnish.shake._properties[b]=e+(a%2?-1:1)*(10-a);d.animate(Garnish.shake._properties,Garnish.SHAKE_STEP_DURATION)},Garnish.SHAKE_STEP_DURATION*a)})(f)},getElement:function(a){return c.makeArray(a)[0]},getInputBasename:function(a){return(a=c(a).attr("name"))?a.replace(/\[.*/,""):null},getInputPostVal:function(a){var b=a.attr("type"),c=a.val();return"checkbox"==b||"radio"==b?a.prop("checked")?c:null:Garnish.isArray(c)&&"[]"!=a.attr("name").substr(-2)?c.length?c[c.length-1]:null:c},findInputs:function(a){return c(a).find("input,text,textarea,select,button")},
getPostData:function(a){var b={},d={};a=Garnish.findInputs(a);for(var e=0;e<a.length;e++){var f=c(a[e]);if(!f.prop("disabled")){var g=f.attr("name");if(g&&(f=Garnish.getInputPostVal(f),null!==f)){var k="[]"==g.substr(-2);if(k){var p=g.substring(0,g.length-2);"undefined"==typeof d[p]&&(d[p]=0)}Garnish.isArray(f)||(f=[f]);for(var l=0;l<f.length;l++)k&&(g=p+"["+d[p]+"]",d[p]++),b[g]=f[l]}}}return b}});Garnish.Base=h.extend({settings:null,_eventHandlers:null,_namespace:null,_$listeners:null,constructor:function(){this._eventHandlers=
[];this._namespace=".Garnish"+Math.floor(1E9*Math.random());this._$listeners=c();this.init.apply(this,arguments)},init:c.noop,setSettings:function(a,b){this.settings=c.extend({},"undefined"==typeof this.settings?{}:this.settings,b,a)},on:function(a,b,c){"function"==typeof b&&(c=b,b={});a=this._normalizeEvents(a);for(var e=0;e<a.length;e++){var f=a[e];this._eventHandlers.push({type:f[0],namepsace:f[1],data:b,handler:c})}},off:function(a){a=this._normalizeEvents(a);for(var b=0;b<a;b++)for(var c=a[b],
e=this._eventHandlers.length-1;0<=e;b--){var f=this._eventHandlers[e];f.type!=c[0]||c[1]&&f.namespace!=c[1]||this._eventHandlers.splice(e,1)}},trigger:function(a,b){var d={type:a,target:this};"undefined"==typeof params&&(params=[]);for(var e=0;e<this._eventHandlers.length;e++){var f=this._eventHandlers[e];if(f.type==a){var g=c.extend({data:f.data},b,d);f.handler(g)}}},_normalizeEvents:function(a){"string"==typeof a&&(a=a.split(" "));for(var b=0;b<a.length;b++)"string"==typeof a[b]&&(a[b]=a[b].split("."));
return a},_formatEvents:function(a){if("string"==typeof a){a=a.split(",");for(var b=0;b<a.length;b++)a[b]=c.trim(a[b])}for(b=0;b<a.length;b++)a[b]+=this._namespace;return a.join(" ")},addListener:function(a,b,d,e){var f=c(a);b=this._formatEvents(b);"object"!=typeof d&&(e=d,d={});e="function"==typeof e?c.proxy(e,this):c.proxy(this,e);f.on(b,d,e);this._$listeners=this._$listeners.add(a);if(-1!=b.search(/\bactivate\b/)&&!f.data("garnish-activatable")){var g=this._namespace+"-activate";f.on("mousedown"+
g,function(a){a.preventDefault()});f.on("click"+g,function(b){b.preventDefault();b=c.inArray(b.currentTarget,f);b=c(a[b]);b.hasClass("disabled")||b.trigger("activate")});f.on("keydown"+g,function(a){var b=c.inArray(a.currentTarget,f);if(-1!=b&&a.keyCode==Garnish.SPACE_KEY){a.preventDefault();var d=c(f[b]);d.hasClass("disabled")||(d.addClass("active"),Garnish.$doc.on("keyup"+g,function(a){f.removeClass("active");a.keyCode==Garnish.SPACE_KEY&&(a.preventDefault(),d.trigger("activate"));Garnish.$doc.off("keyup"+
g)}))}});f.hasClass("disabled")?f.removeAttr("tabindex"):f.attr("tabindex","0");f.data("garnish-activatable",!0)}if(-1!=b.search(/\btextchange\b/))for(d=0;d<f.length;d++)e=c(f[d]),e.data("garnish-textchangeValue",e.val()),e.data("garnish-textchangeable")||(b=this._namespace+"-textchange",b="keypress"+b+" keyup"+b+" change"+b+" blur"+b,e.on(b,function(a){a=c(a.currentTarget);var b=a.val();b!=a.data("garnish-textchangeValue")&&(a.data("garnish-textchangeValue",b),a.trigger("textchange"))}),e.data("garnish-textchangeable",
!0));if(-1!=b.search(/\bresize\b/))for(d=0;d<f.length;d++)(function(a){if(a!=window&&!document.attachEvent&&!a.__resizeTriggers__){"static"==getComputedStyle(a).position&&(a.style.position="relative");var b=c('<div class="resize-triggers"><div class="expand-trigger"><div></div></div><div class="contract-trigger"></div></div>').prependTo(a);a.__resizeLast__={};a.__resizeTriggers__=b[0];q(a);a.addEventListener("scroll",r,!0);Garnish.$win.on("resize",function(){r.apply(a)});b.next().addClass("first")}})(f[d])},
removeListener:function(a,b){b=this._formatEvents(b);c(a).off(b)},removeAllListeners:function(a){c(a).off(this._namespace)},destroy:function(){this.removeAllListeners(this._$listeners)}});if(!document.attachEvent)var s=function(){var a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||function(a){return window.setTimeout(a,20)};return function(b){return a(b)}}(),t=function(){var a=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||
window.clearTimeout;return function(b){return a(b)}}(),q=function(a){var b=a.__resizeTriggers__;a=b.firstElementChild;var b=b.lastElementChild,c=a.firstElementChild;b.scrollLeft=b.scrollWidth;b.scrollTop=b.scrollHeight;c.style.width=a.offsetWidth+1+"px";c.style.height=a.offsetHeight+1+"px";a.scrollLeft=a.scrollWidth;a.scrollTop=a.scrollHeight},r=function(a){var b=this;q(b);b.__resizeRAF__&&t(b.__resizeRAF__);b.__resizeRAF__=s(function(){if(b.offsetWidth!=b.__resizeLast__.width||b.offsetHeight!=b.__resizeLast__.height)b.__resizeLast__.width=
b.offsetWidth,b.__resizeLast__.height=b.offsetHeight,c(b).trigger("resize")})};Garnish.BaseDrag=Garnish.Base.extend({$items:null,dragging:!1,mousedownX:null,mousedownY:null,mouseDistX:null,mouseDistY:null,$targetItem:null,targetItemMouseDiffX:null,targetItemMouseDiffY:null,mouseX:null,mouseY:null,lastMouseX:null,lastMouseY:null,scrollProperty:null,scrollDir:null,_:null,init:function(a,b){!b&&c.isPlainObject(a)&&(b=a,a=null);this.settings=c.extend({},Garnish.BaseDrag.defaults,b);this.$items=c();this._=
{};a&&this.addItems(a)},onMouseDown:function(a){if(a.which==Garnish.PRIMARY_CLICK&&!this.$targetItem){if(a.currentTarget!=a.target&&this.settings.ignoreHandleSelector){var b=c(a.target);if(b.is(this.settings.ignoreHandleSelector)||b.closest(this.settings.ignoreHandleSelector).length)return}a.preventDefault();this.$targetItem=c(c.data(a.currentTarget,"drag-item"));this.mousedownX=this.mouseX=a.pageX;this.mousedownY=this.mouseY=a.pageY;b=this.$targetItem.offset();this.targetItemMouseDiffX=a.pageX-b.left;
this.targetItemMouseDiffY=a.pageY-b.top;this.addListener(Garnish.$doc,"mousemove","onMouseMove");this.addListener(Garnish.$doc,"mouseup","onMouseUp")}},onMouseMove:function(a){a&&(a.preventDefault(),this.settings.axis!=Garnish.Y_AXIS&&(this.mouseX=a.pageX),this.settings.axis!=Garnish.X_AXIS&&(this.mouseY=a.pageY));this.mouseDistX=this.mouseX-this.mousedownX;this.mouseDistY=this.mouseY-this.mousedownY;if(!this.dragging)if(this.onMouseMove._mouseDist=Garnish.getDist(this.mousedownX,this.mousedownY,
this.mouseX,this.mouseY),this.onMouseMove._mouseDist>=Garnish.BaseDrag.minMouseDist)this.startDragging();else return;a&&(this.onMouseMove._scrollProperty=null,this.settings.axis!=Garnish.X_AXIS&&(this.onMouseMove._winScrollTop=Garnish.$win.scrollTop(),this.mouseY<this.onMouseMove._winScrollTop+Garnish.BaseDrag.windowScrollTargetSize?(this.onMouseMove._scrollProperty="scrollTop",this.onMouseMove._scrollDir=-1):(this.onMouseMove._winHeight=Garnish.$win.height(),this.mouseY>this.onMouseMove._winScrollTop+
this.onMouseMove._winHeight-Garnish.BaseDrag.windowScrollTargetSize&&(this.onMouseMove._scrollProperty="scrollTop",this.onMouseMove._scrollDir=1))),this.onMouseMove._scrollProperty||this.settings.axis==Garnish.Y_AXIS||(this.onMouseMove._winScrollLeft=Garnish.$win.scrollLeft(),this.mouseX<this.onMouseMove._winScrollLeft+Garnish.BaseDrag.windowScrollTargetSize?(this.onMouseMove._scrollProperty="scrollLeft",this.onMouseMove._scrollDir=-1):(this.onMouseMove._winWidth=Garnish.$win.width(),this.mouseX>
this.onMouseMove._winScrollLeft+this.onMouseMove._winWidth-Garnish.BaseDrag.windowScrollTargetSize&&(this.onMouseMove._scrollProperty="scrollLeft",this.onMouseMove._scrollDir=1))),this.onMouseMove._scrollProperty?(this.scrollProperty||(this.scrollInterval=setInterval(c.proxy(this,"scrollWindow"),20)),this.scrollProperty=this.onMouseMove._scrollProperty,this.scrollDir=this.onMouseMove._scrollDir):this.cancelWindowScroll());this.onDrag()},scrollWindow:function(){this._.scrollPos=Garnish.$win[this.scrollProperty]();
Garnish.$win[this.scrollProperty](this._.scrollPos+3*this.scrollDir);this.mouseY-=this._.scrollPos-Garnish.$win[this.scrollProperty]();this.onMouseMove()},cancelWindowScroll:function(){this.scrollInterval&&(clearInterval(this.scrollInterval),this.scrollInterval=null);this.scrollDir=this.scrollProperty=null},onMouseUp:function(a){this.removeAllListeners(Garnish.$doc);this.dragging&&this.stopDragging();this.$targetItem=null},startDragging:function(){switch(typeof this.settings.filter){case "function":this.$draggee=
this.settings.filter();break;case "string":this.$draggee=this.$items.filter(this.settings.filter);break;default:this.$draggee=this.$targetItem}this.$draggee=c([this.$targetItem[0]].concat(this.$draggee.not(this.$targetItem[0]).toArray()));this.dragging=!0;this.onDragStart()},stopDragging:function(){this.dragging=!1;this.onDragStop();this.cancelWindowScroll()},onDragStart:function(){this.settings.onDragStart()},onDrag:function(){this.settings.onDrag()},onDragStop:function(){this.settings.onDragStop()},
addItems:function(a){a=c.makeArray(a);for(var b=0;b<a.length;b++){var d=a[b];c.data(d,"drag")&&(Garnish.log("Element was added to more than one dragger"),c.data(d,"drag").removeItems(d));c.data(d,"drag",this);if(this.settings.handle)if("object"==typeof this.settings.handle)var e=c(this.settings.handle);else"string"==typeof this.settings.handle?e=c(d).find(this.settings.handle):"function"==typeof this.settings.handle&&(e=c(this.settings.handle(d)));else e=c(d);c.data(d,"drag-handle",e);e.data("drag-item",
d);this.addListener(e,"mousedown","onMouseDown")}this.$items=c().add(this.$items.add(a))},removeItems:function(a){a=c.makeArray(a);for(var b=0;b<a.length;b++){var d=a[b],e=c.inArray(d,this.$items);if(-1!=e){var f=c.data(d,"drag-handle");f.data("drag-item",null);c.data(d,"drag",null);c.data(d,"drag-handle",null);this.removeAllListeners(f);this.$items.splice(e,1)}}},removeAllItems:function(){for(var a=0;a<this.$items.length;a++){var b=this.$items[a],d=c.data(b,"drag-handle");c.data(b,"drag",null);d&&
(c.data(b,"drag-handle",null),d.data("drag-item",null),this.removeAllListeners(d))}this.$items=c()}},{minMouseDist:1,windowScrollTargetSize:20,defaults:{handle:null,filter:null,axis:null,ignoreHandleSelector:"input, textarea, button, select, .btn",onDragStart:c.noop,onDrag:c.noop,onDragStop:c.noop}});Garnish.CheckboxSelect=Garnish.Base.extend({$container:null,$all:null,$options:null,init:function(a){this.$container=c(a);this.$container.data("checkboxSelect")&&(Garnish.log("Double-instantiating a checkbox select on an element"),
this.$container.data("checkbox-select").destroy());this.$container.data("checkboxSelect",this);a=this.$container.find("input");this.$all=a.filter(".all:first");this.$options=a.not(this.$all);this.addListener(this.$all,"change","onAllChange")},onAllChange:function(){var a=this.$all.prop("checked");this.$options.prop({checked:a,disabled:a})}});Garnish.ContextMenu=Garnish.Base.extend({$target:null,options:null,$menu:null,showingMenu:!1,init:function(a,b,d){this.$target=c(a);this.$target.data("contextmenu")&&
(Garnish.log("Double-instantiating a context menu on an element"),this.$target.data("contextmenu").destroy());this.$target.data("contextmenu",this);this.options=b;this.setSettings(d,Garnish.ContextMenu.defaults);Garnish.ContextMenu.counter++;this.enable()},buildMenu:function(){this.$menu=c('<div class="'+this.settings.menuClass+'" style="display: none" />');var a=c("<ul/>").appendTo(this.$menu),b;for(b in this.options){var d=this.options[b];if("-"==d)a=c("<ul/>").appendTo(this.$menu);else{var e=c("<li></li>").appendTo(a),
e=c("<a>"+d.label+"</a>").appendTo(e);"function"==typeof d.onClick&&function(a,b){setTimeout(c.proxy(function(){a.mousedown(c.proxy(function(a){this.hideMenu();b.call(this.currentTarget,c.extend(a,{currentTarget:this.currentTarget}))},this))},this),1)}.call(this,e,d.onClick)}}},showMenu:function(a){if("mousedown"!=a.type||a.which==Garnish.SECONDARY_CLICK)"contextmenu"==a.type&&a.preventDefault(),this.showing&&a.currentTarget==this.currentTarget||(this.currentTarget=a.currentTarget,this.$menu||this.buildMenu(),
this.$menu.appendTo(document.body),this.$menu.show(),this.$menu.css({left:a.pageX+1,top:a.pageY-4}),this.showing=!0,setTimeout(c.proxy(function(){this.addListener(Garnish.$doc,"mousedown","hideMenu")},this),0))},hideMenu:function(){this.removeListener(Garnish.$doc,"mousedown");this.$menu.hide();this.showing=!1},enable:function(){this.addListener(this.$target,"contextmenu,mousedown","showMenu")},disable:function(){this.removeListener(this.$target,"contextmenu,mousedown")}},{defaults:{menuClass:"menu"},
counter:0});Garnish.Drag=Garnish.BaseDrag.extend({$draggee:null,otherItems:null,totalOtherItems:null,helpers:null,helperTargets:null,helperPositions:null,helperLagIncrement:null,updateHelperPosInterval:null,draggeeMouseOffsetX:null,draggeeMouseOffsetY:null,init:function(a,b){!b&&c.isPlainObject(a)&&(b=a,a=null);b=c.extend({},Garnish.Drag.defaults,b);this.base(a,b)},onDragStart:function(){this.helpers=[];this.helperTargets=[];this.helperPositions=[];this.draggeeDisplay=this.$draggee.css("display");
this.createHelpers();this.settings.removeDraggee?this.$draggee.hide():this.$draggee.css("visibility","hidden");this.lastMouseX=this.lastMouseY=null;this.otherItems=[];for(var a=0;a<this.$items.length;a++){var b=this.$items[a];-1==c.inArray(b,this.$draggee)&&this.otherItems.push(b)}this.totalOtherItems=this.otherItems.length;this.helperLagIncrement=1==this.helpers.length?0:Garnish.Drag.helperLagIncrementDividend/(this.helpers.length-1);this.updateHelperPosInterval=setInterval(c.proxy(this,"updateHelperPos"),
Garnish.Drag.updateHelperPosInterval);a=this.$draggee.offset();this.draggeeMouseOffsetX=this.mouseX-(a.left+this.$draggee.outerWidth()/2);this.draggeeMouseOffsetY=this.mouseY-(a.top+this.$draggee.outerHeight()/2);this.base()},onDragStop:function(){clearInterval(this.updateHelperPosInterval);this.base()},createHelpers:function(){for(var a=0;a<this.$draggee.length;a++){var b=c(this.$draggee[a]),d=b.clone().addClass("draghelper");d.css({width:b.width(),height:b.height(),margin:0});this.settings.helper&&
(d="function"==typeof this.settings.helper?this.settings.helper(d):c(this.settings.helper).append(d));d.appendTo(Garnish.$bod);b=this.getHelperTarget(a);d.css({position:"absolute",top:b.top,left:b.left,zIndex:Garnish.Drag.helperZindex+this.$draggee.length-a,opacity:this.settings.helperOpacity});this.helperPositions[a]={top:b.top,left:b.left};this.helpers.push(d)}},getHelperTarget:function(a){return{left:this.mouseX-this.targetItemMouseDiffX+a*Garnish.Drag.helperSpacingX,top:this.mouseY-this.targetItemMouseDiffY+
a*Garnish.Drag.helperSpacingY}},updateHelperPos:function(){if(this.mouseX!==this.lastMouseX||this.mouseY!==this.lastMouseY){for(this.updateHelperPos._i=0;this.updateHelperPos._i<this.helpers.length;this.updateHelperPos._i++)this.helperTargets[this.updateHelperPos._i]=this.getHelperTarget(this.updateHelperPos._i);this.lastMouseX=this.mouseX;this.lastMouseY=this.mouseY}for(this.updateHelperPos._j=0;this.updateHelperPos._j<this.helpers.length;this.updateHelperPos._j++)this.updateHelperPos._lag=Garnish.Drag.helperLagBase+
this.helperLagIncrement*this.updateHelperPos._j,this.helperPositions[this.updateHelperPos._j]={left:this.helperPositions[this.updateHelperPos._j].left+(this.helperTargets[this.updateHelperPos._j].left-this.helperPositions[this.updateHelperPos._j].left)/this.updateHelperPos._lag,top:this.helperPositions[this.updateHelperPos._j].top+(this.helperTargets[this.updateHelperPos._j].top-this.helperPositions[this.updateHelperPos._j].top)/this.updateHelperPos._lag},this.helpers[this.updateHelperPos._j].css(this.helperPositions[this.updateHelperPos._j])},
returnHelpersToDraggees:function(){for(var a=0;a<this.$draggee.length;a++){var b=c(this.$draggee[a]),d=this.helpers[a],e=b.offset();(function(a,b){b.animate({left:e.left,top:e.top},"fast",function(){a.css("visibility","inherit");b.remove()})})(b,d)}}},{helperZindex:1E3,helperLagBase:1,helperLagIncrementDividend:1.5,updateHelperPosInterval:20,helperSpacingX:5,helperSpacingY:5,defaults:{removeDraggee:!1,helperOpacity:1,helper:null}});Garnish.DragDrop=Garnish.Drag.extend({$dropTargets:null,$activeDropTarget:null,
init:function(a){a=c.extend({},Garnish.DragDrop.defaults,a);this.base(a)},onDragStart:function(){this.settings.dropTargets&&(this.$dropTargets="function"==typeof this.settings.dropTargets?c(this.settings.dropTargets()):c(this.settings.dropTargets),this.$dropTargets.length||(this.$dropTargets=null));this.$activeDropTarget=null;this.base()},onDrag:function(){if(this.$dropTargets){this.onDrag._activeDropTarget=null;for(this.onDrag._i=0;this.onDrag._i<this.$dropTargets.length;this.onDrag._i++)if(this.onDrag._elem=
this.$dropTargets[this.onDrag._i],Garnish.hitTest(this.mouseX,this.mouseY,this.onDrag._elem)){this.onDrag._activeDropTarget=this.onDrag._elem;break}if(this.$activeDropTarget&&this.onDrag._activeDropTarget!=this.$activeDropTarget[0]||!this.$activeDropTarget&&null!==this.onDrag._activeDropTarget)this.$activeDropTarget&&this.$activeDropTarget.removeClass(this.settings.activeDropTargetClass),this.$activeDropTarget=this.onDrag._activeDropTarget?c(this.onDrag._activeDropTarget).addClass(this.settings.activeDropTargetClass):
null,this.settings.onDropTargetChange(this.$activeDropTarget)}this.base()},onDragStop:function(){this.$dropTargets&&this.$activeDropTarget&&this.$activeDropTarget.removeClass(this.settings.activeDropTargetClass);this.base()},fadeOutHelpers:function(){for(var a=0;a<this.helpers.length;a++)(function(a){a.fadeOut("fast",function(){a.remove()})})(this.helpers[a])}},{defaults:{dropTargets:null,onDropTargetChange:c.noop,activeDropTargetClass:"active"}});Garnish.DragMove=Garnish.BaseDrag.extend({onDrag:function(a,
b){this.$targetItem.css({left:this.mouseX-this.targetItemMouseDiffX,top:this.mouseY-this.targetItemMouseDiffY})}});Garnish.DragSort=Garnish.Drag.extend({$heightedContainer:null,$insertion:null,$caboose:null,startDraggeeIndex:null,closestItem:null,draggeeMidpointX:null,draggeeMidpointY:null,init:function(a,b){!b&&c.isPlainObject(a)&&(b=a,a=null);b=c.extend({},Garnish.DragSort.defaults,b);this.base(a,b);this.settings.caboose&&(this.$caboose="function"==typeof this.settings.caboose?c(this.settings.caboose()):
c(this.settings.caboose))},onDragStart:function(){this.base();if(this.$caboose){var a=c().add(this.$items).last();this.$caboose.insertAfter(a);this.otherItems.push(this.$caboose[0]);this.totalOtherItems++}this.closestItem=null;this.setMidpoints();this.setInsertion();if(this.settings.container)for(this.$heightedContainer=c(this.settings.container);!this.$heightedContainer.height();)this.$heightedContainer=this.$heightedContainer.parent();this.startDraggeeIndex=c.inArray(this.$draggee[0],this.$items)},
setInsertion:function(){this.settings.insertion&&(this.$insertion="function"==typeof this.settings.insertion?c(this.settings.insertion(this.$draggee)):c(this.settings.insertion))},setMidpoints:function(){for(var a=0;a<this.$items.length;a++)this.setMidpoint(this.$items[a]);this.setMidpoint(this.$caboose)},setMidpoint:function(a){a=c(a);var b=a.offset();a.data("midpoint",{left:b.left+a.outerWidth()/2,top:b.top+a.outerHeight()/2})},onDrag:function(){this.draggeeMidpointX=this.mouseX-this.draggeeMouseOffsetX;
this.draggeeMidpointY=this.mouseY-this.draggeeMouseOffsetY;if(this.$heightedContainer&&!Garnish.hitTest(this.mouseX,this.mouseY,this.$heightedContainer))this.closestItem&&(this.closestItem=null,this.$insertion&&this.$insertion.remove());else if(this.closestItem!=(this.closestItem=this.getClosestItem())&&this.closestItem!=this.$draggee[0])this.onInsertionPointChange();this.base()},getClosestItem:function(){this.getClosestItem._closestItem=this.$draggee[0];this.getClosestItem._midpoint=this.$draggee.data("midpoint");
this.getClosestItem._closestItemMouseDiff=Garnish.getDist(this.getClosestItem._midpoint.left,this.getClosestItem._midpoint.top,this.draggeeMidpointX,this.draggeeMidpointY);for(this.getClosestItem._i=0;this.getClosestItem._i<this.totalOtherItems;this.getClosestItem._i++)this.testForClosestItem(this.otherItems[this.getClosestItem._i]);return this.getClosestItem._closestItem},testForClosestItem:function(a){this.getClosestItem._$item=c(a);this.getClosestItem._midpoint=this.getClosestItem._$item.data("midpoint");
if(this.getClosestItem._midpoint.top>=this.draggeeMidpointY||this.getClosestItem._midpoint.left>=this.draggeeMidpointX)this.getClosestItem._mouseDiff=Garnish.getDist(this.getClosestItem._midpoint.left,this.getClosestItem._midpoint.top,this.draggeeMidpointX,this.draggeeMidpointY),this.getClosestItem._mouseDiff<this.getClosestItem._closestItemMouseDiff&&(this.getClosestItem._closestItem=this.getClosestItem._$item[0],this.getClosestItem._closestItemMouseDiff=this.getClosestItem._mouseDiff)},onInsertionPointChange:function(){this.closestItem&&
(this.$draggee.insertBefore(this.closestItem),this.$insertion&&this.$insertion.insertBefore(this.closestItem));this.setMidpoints();this.settings.onInsertionPointChange()},onDragStop:function(){this.$caboose&&this.$caboose.remove();this.$insertion&&this.$insertion.remove();this.$draggee.css({display:this.draggeeDisplay,visibility:"hidden"});this.returnHelpersToDraggees();this.base();this.$items=c().add(this.$items);var a=c.inArray(this.$draggee[0],this.$items);if(this.startDraggeeIndex!=a)this.settings.onSortChange()}},
{defaults:{container:null,insertion:null,onInsertionPointChange:c.noop,onSortChange:c.noop}});Garnish.EscManager=Garnish.Base.extend({handlers:null,init:function(){this.handlers=[];this.addListener(Garnish.$bod,"keyup",function(a){a.keyCode==Garnish.ESC_KEY&&this.escapeLatest(a)})},register:function(a,b){this.handlers.push({obj:a,func:b})},unregister:function(a){for(var b=this.handlers.length-1;0<=b;b--)this.handlers[b].obj==a&&this.handlers.splice(b,1)},escapeLatest:function(a){if(this.handlers.length){var b=
this.handlers.pop();("function"==typeof b.func?b.func:b.obj[b.func]).call(b.obj,a)}}});Garnish.escManager=new Garnish.EscManager;Garnish.HUD=Garnish.Base.extend({$trigger:null,$hud:null,$tip:null,$body:null,$shade:null,windowWidth:null,windowHeight:null,windowScrollLeft:null,windowScrollTop:null,triggerWidth:null,triggerHeight:null,triggerOffset:null,width:null,height:null,showing:!1,position:null,init:function(a,b,d){this.$trigger=c(a);this.setSettings(d,Garnish.HUD.defaults);this.on("show",this.settings.onShow);
this.on("hide",this.settings.onHide);"undefined"==typeof Garnish.HUD.activeHUDs&&(Garnish.HUD.activeHUDs={});this.$shade=c('<div class="hud-shade"/>');this.$hud=c('<div class="'+this.settings.hudClass+'" />');this.$tip=c('<div class="'+this.settings.tipClass+'" />').appendTo(this.$hud);this.$body=c('<div class="'+this.settings.bodyClass+'" />').appendTo(this.$hud).append(b);this.$body.find(".footer").length&&this.$hud.addClass("has-footer");this.show()},show:function(a){a&&a.stopPropagation&&a.stopPropagation();
if(!this.showing){if(this.settings.closeOtherHUDs)for(var b in Garnish.HUD.activeHUDs)Garnish.HUD.activeHUDs[b].hide();this.$hud.css("top",Garnish.$win.scrollTop());this.$shade.appendTo(Garnish.$bod);this.$hud.appendTo(Garnish.$bod);this.$hud.show();this.determineBestPosition();this.setPosition();this.$shade.show();this.showing=!0;Garnish.HUD.activeHUDs[this._namespace]=this;Garnish.escManager.register(this,"hide");this.addListener(this.$hud,"resize","resetPosition");this.addListener(Garnish.$win,
"resize","resetPosition");this.addListener(this.$shade,"click","hide");this.settings.closeBtn&&this.addListener(this.settings.closeBtn,"activate","hide");this.onShow()}},onShow:function(){this.trigger("show")},updateElementProperties:function(){this.windowWidth=Garnish.$win.width();this.windowHeight=Garnish.$win.height();this.windowScrollLeft=Garnish.$win.scrollLeft();this.windowScrollTop=Garnish.$win.scrollTop();this.triggerWidth=this.$trigger.outerWidth();this.triggerHeight=this.$trigger.outerHeight();
this.triggerOffset=this.$trigger.offset();this.triggerOffset.right=this.triggerOffset.left+this.triggerWidth;this.triggerOffset.bottom=this.triggerOffset.top+this.triggerHeight;this.width=this.$hud.outerWidth();this.height=this.$hud.outerHeight()},determineBestPosition:function(){this.updateElementProperties();this.minHorizontalClearance=this.width+this.settings.triggerSpacing+this.settings.windowSpacing;this.minVerticalClearance=this.height+this.settings.triggerSpacing+this.settings.windowSpacing;
for(var a=[this.windowHeight+this.windowScrollTop-this.triggerOffset.bottom,this.triggerOffset.top-this.windowScrollTop,this.windowWidth+this.windowScrollLeft-this.triggerOffset.right,this.triggerOffset.left-this.windowScrollLeft],b=0;4>b;b++)if(a[b]-(this.settings.windowSpacing+this.settings.triggerSpacing)>=this[2>b?"height":"width"]){var d=b;break}"undefined"==typeof d&&(b=Math.max.apply(null,a),d=c.inArray(b,a));this.position=Garnish.HUD.positions[d];this.tipClass&&this.$tip.removeClass(this.tipClass);
this.tipClass=this.settings.tipClass+"-"+Garnish.HUD.tipClasses[d];this.$tip.addClass(this.tipClass)},setPosition:function(){if("top"==this.position||"bottom"==this.position){var a=this.windowWidth+this.windowScrollLeft-(this.width+this.settings.windowSpacing),b=this.windowScrollLeft+this.settings.windowSpacing,c=this.triggerOffset.left+Math.round(this.triggerWidth/2),e=c-Math.round(this.width/2);e>a&&(e=a);e<b&&(e=b);this.$hud.css("left",e);this.$tip.css({left:c-e-this.settings.tipWidth/2,top:""});
a="top"==this.position?this.triggerOffset.top-(this.height+this.settings.triggerSpacing):this.triggerOffset.bottom+this.settings.triggerSpacing;this.$hud.css("top",a)}else b=this.windowHeight+this.windowScrollTop-(this.height+this.settings.windowSpacing),e=this.windowScrollTop+this.settings.windowSpacing,c=this.triggerOffset.top+Math.round(this.triggerHeight/2),a=c-Math.round(this.height/2),a>b&&(a=b),a<e&&(a=e),this.$hud.css("top",a),this.$tip.css({top:c-a-this.settings.tipWidth/2,left:""}),e="left"==
this.position?this.triggerOffset.left-(this.width+this.settings.triggerSpacing):this.triggerOffset.right+this.settings.triggerSpacing,this.$hud.css("left",e)},resetPosition:function(){this.updateElementProperties();this.setPosition()},hide:function(){this.$hud.hide();this.$shade.hide();this.showing=!1;delete Garnish.HUD.activeHUDs[this._namespace];Garnish.escManager.unregister(this);this.onHide()},onHide:function(){this.trigger("hide")},toggle:function(){this.showing?this.hide():this.show()}},{positions:["bottom",
"top","right","left"],tipClasses:["top","bottom","left","right"],defaults:{hudClass:"hud",tipClass:"tip",bodyClass:"body",triggerSpacing:10,windowSpacing:10,tipWidth:30,onShow:c.noop,onHide:c.noop,closeBtn:null,closeOtherHUDs:!0}});Garnish.LightSwitch=Garnish.Base.extend({settings:null,$outerContainer:null,$innerContainer:null,$input:null,$toggleTarget:null,on:null,dragger:null,dragStartMargin:null,init:function(a,b){this.$outerContainer=c(a);this.$outerContainer.data("lightswitch")&&(Garnish.log("Double-instantiating a switch on an element"),
this.$outerContainer.data("lightswitch").destroy());this.$outerContainer.data("lightswitch",this);this.setSettings(b,Garnish.LightSwitch.defaults);this.$innerContainer=this.$outerContainer.find(".container:first");this.$input=this.$outerContainer.find("input:first");this.$toggleTarget=c(this.$outerContainer.attr("data-toggle"));this.on=this.$outerContainer.hasClass("on");this.addListener(this.$outerContainer,"mousedown","_onMouseDown");this.addListener(this.$outerContainer,"keydown","_onKeyDown");
this.dragger=new Garnish.BaseDrag(this.$outerContainer,{axis:Garnish.X_AXIS,ignoreHandleSelector:null,onDragStart:c.proxy(this,"_onDragStart"),onDrag:c.proxy(this,"_onDrag"),onDragStop:c.proxy(this,"_onDragStop")})},turnOn:function(){this.$innerContainer.stop().animate({marginLeft:0},"fast");this.$input.val(Garnish.Y_AXIS);this.on=!0;this.settings.onChange();this.$toggleTarget.show();this.$toggleTarget.height("auto");var a=this.$toggleTarget.height();this.$toggleTarget.height(0);this.$toggleTarget.stop().animate({height:a},
"fast",c.proxy(function(){this.$toggleTarget.height("auto")},this))},turnOff:function(){this.$innerContainer.stop().animate({marginLeft:Garnish.LightSwitch.offMargin},"fast");this.$input.val("");this.on=!1;this.settings.onChange();this.$toggleTarget.stop().animate({height:0},"fast")},toggle:function(a){this.on?this.turnOff():this.turnOn()},_onMouseDown:function(){this.addListener(Garnish.$doc,"mouseup","_onMouseUp")},_onMouseUp:function(){this.removeListener(Garnish.$doc,"mouseup");this.dragger.dragging||
this.toggle()},_onKeyDown:function(a){switch(a.keyCode){case Garnish.SPACE_KEY:this.toggle();a.preventDefault();break;case Garnish.RIGHT_KEY:Garnish.ltr?this.turnOn():this.turnOff();a.preventDefault();break;case Garnish.LEFT_KEY:Garnish.ltr?this.turnOff():this.turnOn(),a.preventDefault()}},_getMargin:function(){return parseInt(this.$innerContainer.css("marginLeft"))},_onDragStart:function(){this.dragStartMargin=this._getMargin()},_onDrag:function(){var a=this.dragStartMargin+this.dragger.mouseDistX;
a<Garnish.LightSwitch.offMargin?a=Garnish.LightSwitch.offMargin:0<a&&(a=0);this.$innerContainer.css("marginLeft",a)},_onDragStop:function(){-16<this._getMargin()?this.turnOn():this.turnOff()},destroy:function(){this.base();this.dragger.destroy()}},{offMargin:-50,defaults:{onChange:c.noop}});Garnish.Menu=Garnish.Base.extend({settings:null,$container:null,$options:null,$trigger:null,init:function(a,b){this.setSettings(b,Garnish.Menu.defaults);this.$container=c(a);this.$options=this.$container.find("a");
this.$options.data("menu",this);this.settings.attachToElement&&(this.$trigger=c(this.settings.attachToElement));this.addListener(this.$container,"mousedown",function(a){a.stopPropagation()});this.addListener(this.$options,"click","selectOption")},setPositionRelativeToTrigger:function(){var a=Garnish.$win.height(),b=Garnish.$win.scrollTop(),c=this.$trigger.offset(),e=this.$trigger.outerWidth(),f=this.$trigger.outerHeight(),f=c.top+f,g=c.top,k=this.$container.outerHeight(),a=a+b-f,h=g-b,b={minWidth:e-
(this.$container.outerWidth()-this.$container.width())};b.top=a>=k||a>=h?f:g-k;(f=this.$container.data("align"))||(f="left");Garnish.rtl&&("left"==f?f="right":"right"==f&&(f="left"));switch(f){case "right":b.right=Garnish.$win.width()-(c.left+e);break;case "center":b.left=Math.round(c.left+e/2-this.$container.outerWidth()/2);break;case "left":b.left=c.left}this.$container.css(b)},show:function(){this.$container.appendTo(Garnish.$bod);this.$trigger&&this.setPositionRelativeToTrigger();this.$container.fadeIn(50);
Garnish.escManager.register(this,"hide")},hide:function(){this.$container.fadeOut("fast");Garnish.escManager.unregister(this);this.trigger("hide")},selectOption:function(a){this.settings.onOptionSelect(a.currentTarget);this.trigger("optionselect",{selectedOption:a.currentTarget});this.hide()}},{defaults:{attachToElement:null,onOptionSelect:c.noop}});Garnish.MenuBtn=Garnish.Base.extend({$btn:null,menu:null,showingMenu:!1,init:function(a,b){this.$btn=c(a);this.$btn.data("menubtn")&&(Garnish.log("Double-instantiating a menu button on an element"),
this.$btn.data("menubtn").destroy());this.$btn.data("menubtn",this);this.setSettings(b,Garnish.MenuBtn.defaults);var d=this.$btn.next(".menu").detach();this.menu=new Garnish.Menu(d,{attachToElement:this.$btn,onOptionSelect:c.proxy(this,"onOptionSelect")});this.menu.on("hide",c.proxy(this,"onMenuHide"));this.addListener(this.$btn,"mousedown","onMouseDown")},onMouseDown:function(a){a.which!=Garnish.PRIMARY_CLICK||a.metaKey||(a.preventDefault(),this.showingMenu?this.hideMenu():this.showMenu())},showMenu:function(){this.menu.show();
this.$btn.addClass("active");this.showingMenu=!0;setTimeout(c.proxy(function(){this.addListener(Garnish.$doc,"mousedown","onMouseDown")},this),1);Garnish.isMobileBrowser()||this.addListener(Garnish.$win,"resize","hideMenu")},hideMenu:function(){this.menu.hide()},onMenuHide:function(){this.$btn.removeClass("active");this.showingMenu=!1;this.removeListener(Garnish.$doc,"mousedown");Garnish.isMobileBrowser()||this.removeListener(Garnish.$doc,"resize")},onOptionSelect:function(a){this.settings.onOptionSelect(a)}},
{defaults:{onOptionSelect:c.noop}});Garnish.MixedInput=Garnish.Base.extend({$container:null,elements:null,focussedElement:null,blurTimeout:null,init:function(a,b){this.$container=c(a);this.setSettings(b,Garnish.MixedInput.defaults);this.elements=[];this.$container.attr("tabindex",0);this.addListener(this.$container,"focus","onFocus")},getElementIndex:function(a){return c.inArray(a,this.elements)},isText:function(a){return"INPUT"==a.prop("nodeName")},onFocus:function(a){this.elements.length?(a=this.elements[0],
this.setFocus(a),this.setCarotPos(a,0)):this.addTextElement()},addTextElement:function(a){var b=new n(this);this.addElement(b.$input,a);return b},addElement:function(a,b){if("undefined"==typeof b)if(this.focussedElement){var d=this.focussedElement,e=this.getElementIndex(d);if(this.isText(d)){var f=d.prop("selectionStart"),g=d.prop("selectionEnd"),k=d.val(),f=k.substring(0,f),g=k.substr(g);f&&g?(d.val(f).trigger("change"),d=new n(this),d.$input.val(g).trigger("change"),this.addElement(d.$input,e+1),
b=e+1):b=f?e+1:e}else b=e+1}else b=this.elements.length;"undefined"!=typeof this.elements[b]?(a.insertBefore(this.elements[b]),this.elements.splice(b,0,a)):(b=this.elements.length,this.$container.append(a),this.elements.push(a));this.isText(a)||(0!=b&&this.isText(this.elements[b-1])||(this.addTextElement(b),b++),b!=this.elements.length-1&&this.isText(this.elements[b+1])||this.addTextElement(b+1));this.addListener(a,"click",function(){this.setFocus(a)});setTimeout(c.proxy(function(){this.setFocus(a)},
this),1)},removeElement:function(a){var b=this.getElementIndex(a);if(-1!=b){this.elements.splice(b,1);if(!this.isText(a)){var c=this.elements[b-1],b=this.elements[b];if(this.isText(c)&&this.isText(b)){var e=c.val(),f=e+b.val();c.val(f).trigger("change");this.removeElement(b);this.setFocus(c);this.setCarotPos(c,e.length)}}a.remove()}},setFocus:function(a){this.$container.addClass("focus");this.focussedElement?this.blurFocussedElement():this.$container.attr("tabindex","-1");a.attr("tabindex","0");a.focus();
this.focussedElement=a;this.addListener(a,"blur",function(){this.blurTimeout=setTimeout(c.proxy(function(){this.focussedElement==a&&(this.blurFocussedElement(),this.focussedElement=null,this.$container.removeClass("focus"),this.$container.attr("tabindex","0"))},this),1)})},blurFocussedElement:function(){this.removeListener(this.focussedElement,"blur");this.focussedElement.attr("tabindex","-1")},focusPreviousElement:function(a){a=this.getElementIndex(a);if(0<a&&(a=this.elements[a-1],this.setFocus(a),
this.isText(a))){var b=a.val().length;this.setCarotPos(a,b)}},focusNextElement:function(a){a=this.getElementIndex(a);a<this.elements.length-1&&(a=this.elements[a+1],this.setFocus(a),this.isText(a)&&this.setCarotPos(a,0))},setCarotPos:function(a,b){a.prop("selectionStart",b);a.prop("selectionEnd",b)}});var n=Garnish.Base.extend({parentInput:null,$input:null,$stage:null,val:null,focussed:!1,interval:null,init:function(a){this.parentInput=a;this.$input=c('<input type="text"/>').appendTo(this.parentInput.$container);
this.$input.css("margin-right",2-n.padding+"px");this.setWidth();this.addListener(this.$input,"focus","onFocus");this.addListener(this.$input,"blur","onBlur");this.addListener(this.$input,"keydown","onKeyDown");this.addListener(this.$input,"change","checkInput")},getIndex:function(){return this.parentInput.getElementIndex(this.$input)},buildStage:function(){this.$stage=c("<stage/>").appendTo(Garnish.$bod);this.$stage.css({position:"absolute",top:-9999,left:-9999,wordWrap:"nowrap"});Garnish.copyTextStyles(this.$input,
this.$stage)},getTextWidth:function(a){this.$stage||this.buildStage();a&&(a=a.replace(/&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=a.replace(/ /g,"&nbsp;"));this.$stage.html(a);return this.stageWidth=this.$stage.width()},onFocus:function(){this.focussed=!0;this.interval=setInterval(c.proxy(this,"checkInput"),Garnish.NiceText.interval);this.checkInput()},onBlur:function(){this.focussed=!1;clearInterval(this.interval);this.checkInput()},onKeyDown:function(a){setTimeout(c.proxy(this,
"checkInput"),1);switch(a.keyCode){case Garnish.LEFT_KEY:0==this.$input.prop("selectionStart")&&0==this.$input.prop("selectionEnd")&&this.parentInput.focusPreviousElement(this.$input);break;case Garnish.RIGHT_KEY:this.$input.prop("selectionStart")==this.val.length&&this.$input.prop("selectionEnd")==this.val.length&&this.parentInput.focusNextElement(this.$input);break;case Garnish.DELETE_KEY:0==this.$input.prop("selectionStart")&&0==this.$input.prop("selectionEnd")&&(this.parentInput.focusPreviousElement(this.$input),
a.preventDefault())}},getVal:function(){return this.val=this.$input.val()},setVal:function(a){this.$input.val(a);this.checkInput()},checkInput:function(){var a=this.val!==this.getVal();a&&(this.setWidth(),this.onChange());return a},setWidth:function(){this.stageWidth!==this.getTextWidth(this.val)&&this.$input.width(this.stageWidth+n.padding)},onChange:c.noop},{padding:20});Garnish.Modal=Garnish.Base.extend({$container:null,$shade:null,visible:!1,dragger:null,desiredWidth:null,desiredHeight:null,resizeDragger:null,
resizeStartWidth:null,resizeStartHeight:null,init:function(a,b){!b&&c.isPlainObject(a)&&(b=a,a=null);this.setSettings(b,Garnish.Modal.defaults);this.$shade=a?c('<div class="modal-shade"/>').insertBefore(a):c('<div class="modal-shade"/>').appendTo(Garnish.$bod);a&&(this.setContainer(a),this.show());Garnish.Modal.instances.push(this)},setContainer:function(a){this.$container=c(a);this.$container.data("modal")&&(Garnish.log("Double-instantiating a modal on an element"),this.$container.data("modal").destroy());
this.$container.data("modal",this);this.settings.draggable&&(this.dragger=new Garnish.DragMove(this.$container,{handle:this.settings.dragHandleSelector?this.$container.find(this.settings.dragHandleSelector):this.$container}));this.settings.resizable&&(a=c('<div class="resizehandle"/>').appendTo(this.$container),this.resizeDragger=new Garnish.BaseDrag(a,{onDragStart:c.proxy(this,"_onResizeStart"),onDrag:c.proxy(this,"_onResize")}));this.addListener(this.$container,"click",function(a){a.stopPropagation()});
this.visible&&this.show()},show:function(){this.settings.closeOtherModals&&Garnish.Modal.visibleModal&&Garnish.Modal.visibleModal!=this&&Garnish.Modal.visibleModal.hide();this.$container&&(this.$shade.appendTo(Garnish.$bod),this.$container.appendTo(Garnish.$bod),this.$container.show(),this.updateSizeAndPosition(),this.$shade.fadeIn(50),this.$container.delay(50).fadeIn(c.proxy(this,"onFadeIn")),this.addListener(this.$shade,"click","hide"),this.addListener(Garnish.$win,"resize","updateSizeAndPosition"));
Garnish.escManager.register(this,"hide");this.visible||(this.visible=!0,Garnish.Modal.visibleModal=this,this.settings.onShow())},hide:function(a){a&&a.stopPropagation();this.$container&&(this.$container.fadeOut("fast"),this.$shade.fadeOut("fast",c.proxy(this,"onFadeOut")),this.removeListener(this.$shade,"click"),this.removeListener(Garnish.$win,"resize"));this.visible=!1;Garnish.Modal.visibleModal=null;Garnish.escManager.unregister(this);this.settings.onHide()},updateSizeAndPosition:function(){this.$container&&
(this.$container.css({width:this.desiredWidth?Math.max(this.desiredWidth,200):"",height:this.desiredHeight?Math.max(this.desiredHeight,200):"","min-width":"","min-height":""}),this.updateSizeAndPosition._windowWidth=Garnish.$win.width(),this.updateSizeAndPosition._width=Math.min(this.getWidth(),this.updateSizeAndPosition._windowWidth-20),this.$container.css({width:this.updateSizeAndPosition._width,"min-width":this.updateSizeAndPosition._width,left:Math.round((this.updateSizeAndPosition._windowWidth-
this.updateSizeAndPosition._width)/2)}),this.updateSizeAndPosition._windowHeight=Garnish.$win.height(),this.updateSizeAndPosition._height=Math.min(this.getHeight(),this.updateSizeAndPosition._windowHeight-20),this.$container.css({height:this.updateSizeAndPosition._height,"min-height":this.updateSizeAndPosition._height,top:Math.round((this.updateSizeAndPosition._windowHeight-this.updateSizeAndPosition._height)/2)}))},onFadeIn:function(){this.settings.onFadeIn()},onFadeOut:function(){this.settings.onFadeOut()},
getHeight:function(){if(!this.$container)throw"Attempted to get the height of a modal whose container has not been set.";this.visible||this.$container.show();this.getHeight._height=this.$container.outerHeight();this.visible||this.$container.hide();return this.getHeight._height},getWidth:function(){if(!this.$container)throw"Attempted to get the width of a modal whose container has not been set.";this.visible||this.$container.show();this.getWidth._width=this.$container.outerWidth();this.visible||this.$container.hide();
return this.getWidth._width},_onResizeStart:function(){this.resizeStartWidth=this.getWidth();this.resizeStartHeight=this.getHeight()},_onResize:function(){this.desiredWidth=Garnish.ltr?this.resizeStartWidth+2*this.resizeDragger.mouseDistX:this.resizeStartWidth-2*this.resizeDragger.mouseDistX;this.desiredHeight=this.resizeStartHeight+2*this.resizeDragger.mouseDistY;this.updateSizeAndPosition()},destroy:function(){this.base();this.dragger&&this.dragger.destroy();this.resizeDragger&&this.resizeDragger.destroy()}},
{relativeElemPadding:8,defaults:{draggable:!1,dragHandleSelector:null,resizable:!1,onShow:c.noop,onHide:c.noop,onFadeIn:c.noop,onFadeOut:c.noop,closeOtherModals:!0},instances:[],visibleModal:null});Garnish.NiceText=Garnish.Base.extend({$input:null,$hint:null,$stage:null,autoHeight:null,focussed:!1,showingHint:!1,val:null,inputBoxSizing:"content-box",height:null,minHeight:null,interval:null,initialized:!1,init:function(a,b){this.$input=c(a);this.settings=c.extend({},Garnish.NiceText.defaults,b);this.$input.data("nicetext")&&
(Garnish.log("Double-instantiating a transparent text input on an element"),this.$input.data("nicetext").destroy());this.$input.data("nicetext",this);this.getVal();if(this.autoHeight=this.settings.autoHeight&&"TEXTAREA"==this.$input.prop("nodeName"))this.minHeight=this.getHeightForValue(""),this.updateHeight(),this.addListener(Garnish.$win,"resize","updateHeight");this.settings.hint&&(this.$hintContainer=c('<div class="texthint-container"/>').insertBefore(this.$input),this.$hint=c('<div class="texthint">'+
this.settings.hint+"</div>").appendTo(this.$hintContainer),this.$hint.css({top:parseInt(this.$input.css("borderTopWidth"))+parseInt(this.$input.css("paddingTop")),left:parseInt(this.$input.css("borderLeftWidth"))+parseInt(this.$input.css("paddingLeft"))+1}),Garnish.copyTextStyles(this.$input,this.$hint),this.val?this.$hint.hide():this.showingHint=!0,this.addListener(this.$hint,"mousedown",function(a){a.preventDefault();this.$input.focus()}));this.addListener(this.$input,"focus","onFocus");this.addListener(this.$input,
"blur","onBlur");this.addListener(this.$input,"keydown","onKeyDown");this.initialized=!0},getVal:function(){return this.val=this.$input.val()},showHint:function(){this.$hint.fadeIn(Garnish.NiceText.hintFadeDuration);this.showingHint=!0},hideHint:function(){this.$hint.fadeOut(Garnish.NiceText.hintFadeDuration);this.showingHint=!1},checkInput:function(){var a=this.val!==this.getVal();a&&(this.$hint&&(this.showingHint&&this.val?this.hideHint():this.showingHint||this.val||this.showHint()),this.autoHeight&&
this.updateHeight());return a},buildStage:function(){this.$stage=c("<stage/>").appendTo(Garnish.$bod);this.$stage.css({display:"block",position:"absolute",top:-9999,left:-9999});this.inputBoxSizing=this.$input.css("box-sizing");"border-box"==this.inputBoxSizing&&this.$stage.css({"border-top":this.$input.css("border-top"),"border-right":this.$input.css("border-right"),"border-bottom":this.$input.css("border-bottom"),"border-left":this.$input.css("border-left"),"padding-top":this.$input.css("padding-top"),
"padding-right":this.$input.css("padding-right"),"padding-bottom":this.$input.css("padding-bottom"),"padding-left":this.$input.css("padding-left"),"-webkit-box-sizing":this.inputBoxSizing,"-moz-box-sizing":this.inputBoxSizing,"box-sizing":this.inputBoxSizing});Garnish.copyTextStyles(this.$input,this.$stage)},getHeightForValue:function(a){this.$stage||this.buildStage();"border-box"==this.inputBoxSizing?this.$stage.css("width",this.$input.outerWidth()):this.$stage.css("width",this.$input.width());if(a)a=
a.replace(/&/g,"&amp;"),a=a.replace(/</g,"&lt;"),a=a.replace(/>/g,"&gt;"),a=a.replace(/ /g,"&nbsp;"),a=a.replace(/[\n\r]$/g,"<br/>&nbsp;"),a=a.replace(/[\n\r]/g,"<br/>");else{a="&nbsp;";for(var b=1;b<this.$input.prop("rows");b++)a+="<br/>&nbsp;"}this.$stage.html(a);this.getHeightForValue._height="border-box"==this.inputBoxSizing?this.$stage.outerHeight():this.$stage.height();this.minHeight&&this.getHeightForValue._height<this.minHeight&&(this.getHeightForValue._height=this.minHeight);return this.getHeightForValue._height},
updateHeight:function(){if(this.height!==(this.height=this.getHeightForValue(this.val))&&(this.$input.css("min-height",this.height),this.initialized))this.onHeightChange()},onHeightChange:function(){this.settings.onHeightChange()},onFocus:function(){this.focussed=!0;this.interval=setInterval(c.proxy(this,"checkInput"),Garnish.NiceText.interval);this.checkInput()},onBlur:function(){this.focussed=!1;clearInterval(this.interval);this.checkInput()},onKeyDown:function(){setTimeout(c.proxy(this,"checkInput"),
1)},destroy:function(){this.base();null!==this.$hint&&this.$hint.remove();null!==this.$stage&&this.$stage.remove()}},{interval:100,hintFadeDuration:50,defaults:{autoHeight:!0,onHeightChange:c.noop}});Garnish.Pill=Garnish.Base.extend({$outerContainer:null,$innerContainer:null,$btns:null,$selectedBtn:null,$input:null,init:function(a){this.$outerContainer=c(a);this.$outerContainer.data("pill")&&(Garnish.log("Double-instantiating a pill on an element"),this.$outerContainer.data("pill").destroy());this.$outerContainer.data("pill",
this);this.$innerContainer=this.$outerContainer.find(".btngroup:first");this.$btns=this.$innerContainer.find(".btn");this.$selectedBtn=this.$btns.filter(".active:first");this.$input=this.$outerContainer.find("input:first");Garnish.preventOutlineOnMouseFocus(this.$innerContainer);this.addListener(this.$btns,"mousedown","onMouseDown");this.addListener(this.$innerContainer,"keydown","onKeyDown")},select:function(a){this.$selectedBtn.removeClass("active");a=c(a);a.addClass("active");this.$input.val(a.attr("data-value"));
this.$selectedBtn=a},selectNext:function(){if(this.$selectedBtn.length){var a=this._getSelectedBtnIndex()+1;"undefined"!=typeof this.$btns[a]&&this.select(this.$btns[a])}else this.select(this.$btns[this.$btns.length-1])},selectPrev:function(){if(this.$selectedBtn.length){var a=this._getSelectedBtnIndex()-1;"undefined"!=typeof this.$btns[a]&&this.select(this.$btns[a])}else this.select(this.$btns[0])},onMouseDown:function(a){this.select(a.currentTarget)},_getSelectedBtnIndex:function(){return"undefined"!=
typeof this.$selectedBtn[0]?c.inArray(this.$selectedBtn[0],this.$btns):-1},onKeyDown:function(a){switch(a.keyCode){case Garnish.RIGHT_KEY:Garnish.ltr?this.selectNext():this.selectPrev();a.preventDefault();break;case Garnish.LEFT_KEY:Garnish.ltr?this.selectPrev():this.selectNext(),a.preventDefault()}}});Garnish.Select=Garnish.Base.extend({$container:null,$items:null,totalSelected:null,mousedownX:null,mousedownY:null,mouseUpTimeout:null,callbackTimeout:null,$focusable:null,$first:null,first:null,$last:null,
last:null,init:function(a,b,d){this.$container=c(a);!d&&c.isPlainObject(b)&&(d=b,b=null);this.$container.data("select")&&(Garnish.log("Double-instantiating a select on an element"),this.$container.data("select").destroy());this.$container.data("select",this);this.setSettings(d,Garnish.Select.defaults);this.$items=c();this.addItems(b);this.addListener(this.$container,"click",function(a){this.ignoreClick?this.ignoreClick=!1:this.deselectAll(!0)})},getItemIndex:function(a){return this.$items.index(a[0])},
isSelected:function(a){return a.hasClass(this.settings.selectedClass)},selectItem:function(a){this.settings.multi||this.deselectAll();a.addClass(this.settings.selectedClass);this.$first=this.$last=a;this.first=this.last=this.getItemIndex(a);this.setFocusableItem(a);a.focus();this.totalSelected++;this.setCallbackTimeout()},selectAll:function(){this.settings.multi&&this.$items.length&&(this.first=0,this.last=this.$items.length-1,this.$first=c(this.$items[this.first]),this.$last=c(this.$items[this.last]),
this.$items.addClass(this.settings.selectedClass),this.totalSelected=this.$items.length,this.setCallbackTimeout())},selectRange:function(a){if(!this.settings.multi)return this.selectItem(a);this.deselectAll();this.$last=a;this.last=this.getItemIndex(a);this.setFocusableItem(a);a.focus();if(this.first<this.last){a=this.first;var b=this.last+1}else a=this.last,b=this.first+1;this.$items.slice(a,b).addClass(this.settings.selectedClass);this.totalSelected=b-a;this.setCallbackTimeout()},deselectItem:function(a){a.removeClass(this.settings.selectedClass);
a=this.getItemIndex(a);this.first===a&&(this.$first=this.first=null);this.last===a&&(this.$last=this.last=null);this.totalSelected--;this.setCallbackTimeout()},deselectAll:function(a){this.$items.removeClass(this.settings.selectedClass);a&&(this.$first=this.first=this.$last=this.last=null);this.totalSelected=0;this.setCallbackTimeout()},deselectOthers:function(a){this.deselectAll();this.selectItem(a)},toggleItem:function(a){this.isSelected(a)?this.deselectItem(a):this.selectItem(a)},clearMouseUpTimeout:function(){clearTimeout(this.mouseUpTimeout)},
onMouseDown:function(a){if(a.which==Garnish.PRIMARY_CLICK&&(!this.settings.filter||c(a.target).is(this.settings.filter))){this.mousedownX=a.pageX;this.mousedownY=a.pageY;var b=c(c.data(a.currentTarget,"select-item"));a.metaKey||a.ctrlKey?this.toggleItem(b):null!==this.first&&a.shiftKey&&this.selectRange(b)}},onMouseUp:function(a){if(a.which==Garnish.PRIMARY_CLICK&&(!this.settings.filter||c(a.target).is(this.settings.filter))){var b=c(c.data(a.currentTarget,"select-item"));!a.metaKey&&!a.ctrlKey&&
!a.shiftKey&&1>Garnish.getDist(this.mousedownX,this.mousedownY,a.pageX,a.pageY)&&(this.isSelected(b)?(this.clearMouseUpTimeout(),this.mouseUpTimeout=setTimeout(c.proxy(function(){this.deselectOthers(b)},this),300)):(this.deselectAll(),this.selectItem(b)))}},onKeyDown:function(a){var b=a.metaKey||a.ctrlKey;if(this.settings.arrowsChangeSelection||!this.$focusable.length)var d=a.shiftKey?this.last:this.first;else d=c.inArray(this.$focusable[0],this.$items),-1==d&&(d=0);switch(a.keyCode){case Garnish.LEFT_KEY:a.preventDefault();
var e=null===this.first?Garnish.ltr?this.getLastItem():this.getFirstItem():b?this.getFurthestItemToTheLeft(d):this.getItemToTheLeft(d);break;case Garnish.RIGHT_KEY:a.preventDefault();e=null===this.first?Garnish.ltr?this.getFirstItem():this.getLastItem():b?this.getFurthestItemToTheRight(d):this.getItemToTheRight(d);break;case Garnish.UP_KEY:a.preventDefault();null===this.first?e=this.getLastItem():(e=b?this.getFurthestItemAbove(d):this.getItemAbove(d))||(e=this.getFirstItem());break;case Garnish.DOWN_KEY:a.preventDefault();
null===this.first?e=this.getFirstItem():(e=b?this.getFurthestItemBelow(d):this.getItemBelow(d))||(e=this.getLastItem());break;case Garnish.SPACE_KEY:b||(a.preventDefault(),this.isSelected(this.$focusable)?this.deselectItem(this.$focusable):this.selectItem(this.$focusable));break;case Garnish.A_KEY:b&&(a.preventDefault(),this.selectAll())}e&&e.length&&(this.settings.arrowsChangeSelection?null!==this.first&&a.shiftKey?this.selectRange(e):(this.deselectAll(),this.selectItem(e)):(this.setFocusableItem(e),
e.focus()))},getFirstItem:function(){if(this.$items.length)return c(this.$items[0])},getLastItem:function(){if(this.$items.length)return c(this.$items[this.$items.length-1])},isPreviousItem:function(a){return 0<a},isNextItem:function(a){return a<this.$items.length-1},getPreviousItem:function(a){if(this.isPreviousItem(a))return c(this.$items[a-1])},getNextItem:function(a){if(this.isNextItem(a))return c(this.$items[a+1])},getItemToTheLeft:function(a){var b=Garnish.ltr?"Previous":"Next";if(this["is"+
b+"Item"](a)){if(this.settings.horizontal)return this["get"+b+"Item"](a);if(!this.settings.vertical)return this.getClosestItem(a,Garnish.X_AXIS,"<")}},getItemToTheRight:function(a){var b=Garnish.ltr?"Next":"Previous";if(this["is"+b+"Item"](a)){if(this.settings.horizontal)return this["get"+b+"Item"](a);if(!this.settings.vertical)return this.getClosestItem(a,Garnish.X_AXIS,">")}},getItemAbove:function(a){if(this.isPreviousItem(a)){if(this.settings.vertical)return this.getPreviousItem(a);if(!this.settings.horizontal)return this.getClosestItem(a,
Garnish.Y_AXIS,"<")}},getItemBelow:function(a){if(this.isNextItem(a)){if(this.settings.vertical)return this.getNextItem(a);if(!this.settings.horizontal)return this.getClosestItem(a,Garnish.Y_AXIS,">")}},getClosestItem:function(a,b,d){var e=Garnish.Select.closestItemAxisProps[b];d=Garnish.Select.closestItemDirectionProps[d];var f=c(this.$items[a]),g=f.offset(),f=g[e.midpointOffset]+Math.round(f[e.midpointSizeFunc]()/2),k=null,h=null,l=null;b=Garnish.rtl&&b==Garnish.X_AXIS?-1*d.step:d.step;for(a+=b;"undefined"!=
typeof this.$items[a];a+=b){var n=c(this.$items[a]),m=n.offset();if(d.isNextRow(m[e.rowOffset],g[e.rowOffset])){if(null===k)k=m[e.rowOffset];else if(m[e.rowOffset]!=k)break;m=m[e.midpointOffset]+Math.round(n[e.midpointSizeFunc]()/2);m=Math.abs(f-m);if(null===h||m<h)h=m,l=n;else break}else if(d.isWrongDirection(m[e.rowOffset],g[e.rowOffset]))break}return l},getFurthestItemToTheLeft:function(a){return this.getFurthestItem(a,"ToTheLeft")},getFurthestItemToTheRight:function(a){return this.getFurthestItem(a,
"ToTheRight")},getFurthestItemAbove:function(a){return this.getFurthestItem(a,"Above")},getFurthestItemBelow:function(a){return this.getFurthestItem(a,"Below")},getFurthestItem:function(a,b){for(var c,e;e=this["getItem"+b](a);)c=e,a=this.getItemIndex(c);return c},getTotalSelected:function(){return this.totalSelected},addItems:function(a){a=c(a);for(var b=0;b<a.length;b++){var d=a[b];c.data(d,"select")&&(Garnish.log("Element was added to more than one selector"),c.data(d,"select").removeItems(d));
c.data(d,"select",this);this.$items=this.$items.add(d);if(this.settings.handle)if("object"==typeof this.settings.handle)var e=c(this.settings.handle);else"string"==typeof this.settings.handle?e=c(d).find(this.settings.handle):"function"==typeof this.settings.handle&&(e=c(this.settings.handle(d)));else e=c(d);c.data(d,"select-handle",e);e.data("select-item",d);this.addListener(e,"mousedown","onMouseDown");this.addListener(e,"mouseup","onMouseUp");this.addListener(e,"keydown","onKeyDown");this.addListener(e,
"click",function(a){this.ignoreClick=!0})}this.totalSelected+=a.filter("."+this.settings.selectedClass).length;this.updateIndexes()},removeItems:function(a){a=c.makeArray(a);for(var b=0;b<a.length;b++){var d=a[b],e=c.inArray(d,this.$items);if(-1!=e){var f=c.data(d,"select-handle");f.data("select-item",null);c.data(d,"select",null);c.data(d,"select-handle",null);this.removeAllListeners(f);this.$items.splice(e,1)}}this.updateIndexes()},refreshItemOrder:function(){this.$items=c(this.$items)},destroy:function(){this.base();
this.clearCallbackTimeout()},updateIndexes:function(){null!==this.first?(this.first=this.getItemIndex(this.$first),this.last=this.getItemIndex(this.$last),this.setFocusableItem(this.$first)):this.$items.length&&this.setFocusableItem(c(this.$items[0]))},resetItemOrder:function(){this.$items=c().add(this.$items);this.updateIndexes()},setFocusableItem:function(a){this.$focusable&&this.$focusable.removeAttr("tabindex");this.$focusable=a.attr("tabindex","0")},clearCallbackTimeout:function(){this.settings.onSelectionChange&&
clearTimeout(this.callbackTimeout)},setCallbackTimeout:function(){this.settings.onSelectionChange&&(this.clearCallbackTimeout(),this.callbackTimeout=setTimeout(c.proxy(function(){this.callbackTimeout=null;this.settings.onSelectionChange()},this),1))},getSelectedItems:function(){return this.$items.filter("."+this.settings.selectedClass)}},{defaults:{selectedClass:"sel",multi:!1,vertical:!1,horizontal:!1,arrowsChangeSelection:!0,handle:null,filter:null,onSelectionChange:c.noop},closestItemAxisProps:{x:{midpointOffset:"top",
midpointSizeFunc:"outerHeight",rowOffset:"left"},y:{midpointOffset:"left",midpointSizeFunc:"outerWidth",rowOffset:"top"}},closestItemDirectionProps:{"<":{step:-1,isNextRow:function(a,b){return a<b},isWrongDirection:function(a,b){return a>b}},">":{step:1,isNextRow:function(a,b){return a>b},isWrongDirection:function(a,b){return a<b}}}});Garnish.SelectMenu=Garnish.Menu.extend({init:function(a,b,d,e){"function"==typeof d&&(e=d,d={});d=c.extend({},Garnish.SelectMenu.defaults,d);this.base(a,b,d,e);this.selected=
-1},build:function(){this.base();-1!=this.selected&&this._addSelectedOptionClass(this.selected)},select:function(a){a!=this.selected&&(this.dom.ul&&(-1!=this.selected&&(this.dom.options[this.selected].className=""),this._addSelectedOptionClass(a)),this.selected=a,this.setBtnText(c(this.options[a].label).text()),this.base(a))},_addSelectedOptionClass:function(a){this.dom.options[a].className="sel"},setBtnText:function(a){this.dom.$btnLabel.text(a)}},{defaults:{ulClass:"menu select"}})})(jQuery);

//# sourceMappingURL=garnish-0.1.min.map
